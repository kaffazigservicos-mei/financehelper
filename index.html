<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reserva de Emerg√™ncia ‚Äì Simulador Avan√ßado</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root {
      --color-nominal: #fb923c;
      --color-real: #2563eb;
      --color-meta: #16a34a;
    }
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #f4f7fb; 
      margin: 0; 
      padding: 20px; 
      color: #1e293b; 
    }
    .app { 
      max-width: 1000px; 
      margin: auto; 
      background: #fff; 
      padding: 30px; 
      border-radius: 16px; 
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); 
    }
    h1 { 
      text-align: center; 
      color: #0f172a; 
      margin-bottom: 30px; 
      font-size: 28px;
    }
    h3 { 
      color: #1e293b; 
      margin-top: 30px; 
      margin-bottom: 15px;
      font-size: 18px;
    }
    .grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
      gap: 20px; 
      margin-bottom: 20px;
    }
    .input-group { 
      display: flex; 
      flex-direction: column; 
      gap: 6px; 
    }
    label { 
      font-size: 13px; 
      font-weight: bold; 
      color: #475569; 
    }
    input, select { 
      padding: 10px; 
      border: 1px solid #cbd5e1; 
      border-radius: 8px; 
      font-size: 14px; 
      transition: border-color 0.2s; 
    }
    input:focus, select:focus { 
      outline: none; 
      border-color: var(--color-real); 
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    small { 
      color: #64748b; 
      font-size: 11px; 
      line-height: 1.4; 
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    button { 
      padding: 14px 24px; 
      font-weight: bold; 
      cursor: pointer; 
      border: none; 
      border-radius: 8px; 
      transition: all 0.2s;
      font-size: 14px;
      flex: 1;
      min-width: 150px;
    }
    .btn-primary { 
      background: var(--color-real); 
      color: white; 
    }
    .btn-primary:hover { 
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    .btn-secondary { 
      background: #f1f5f9; 
      color: #475569;
    }
    .btn-secondary:hover {
      background: #e2e8f0;
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    .alert { 
      background: #fff3cd; 
      padding: 15px; 
      border-radius: 10px; 
      margin-top: 20px; 
      border-left: 4px solid #f59e0b; 
      font-size: 14px; 
      color: #92400e;
    }
    .ok { 
      background: #dcfce7; 
      border-left-color: var(--color-meta); 
      color: #166534; 
    }
    .reserva { 
      background: #e0f2fe; 
      padding: 20px; 
      border-radius: 10px; 
      margin-top: 20px; 
      font-weight: bold; 
      color: #0369a1; 
      text-align: center; 
      font-size: 18px;
      border-left: 4px solid var(--color-real);
    }
    .chart-container { 
      position: relative; 
      background: #fff; 
      padding: 20px; 
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      margin-top: 30px;
    }
    canvas { 
      max-height: 400px;
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 13px; 
      margin-top: 30px;
      border: 1px solid #e2e8f0;
    }
    th, td { 
      border: 1px solid #e2e8f0; 
      padding: 12px; 
      text-align: right; 
    }
    th { 
      background: #f8fafc; 
      color: #64748b; 
      font-weight: 600;
      text-align: left;
    }
    td:first-child, th:first-child {
      text-align: left;
    }
    .meta-row { 
      background: #f0fdf4; 
      font-weight: bold; 
      color: var(--color-meta); 
    }
    .educational-section { 
      margin-top: 40px; 
      padding: 20px; 
      background: #f8fafc;
      border-radius: 10px;
      border-left: 4px solid var(--color-real);
    }
    .educational-section p { 
      line-height: 1.6; 
      color: #475569; 
      font-size: 14px;
      margin: 10px 0;
    }
    
    /* Estilos para o PDF */
    .pdf-hidden {
      display: none;
      position: absolute;
      left: -9999px;
      width: 800px;
      background: white;
      padding: 40px;
      font-family: Arial, sans-serif;
      color: #1e293b;
    }
    .pdf-header {
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }
    .pdf-header h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
      text-align: left;
    }
    .pdf-header p {
      margin: 5px 0;
      font-size: 12px;
      color: #64748b;
    }
    .pdf-concept {
      margin-bottom: 25px;
      padding: 15px;
      background: #f8fafc;
      border-radius: 8px;
      page-break-inside: avoid;
    }
    .pdf-concept h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #1e293b;
    }
    .pdf-concept p {
      margin: 0 0 8px 0;
      font-size: 12px;
      line-height: 1.5;
      color: #475569;
    }
    .pdf-summary {
      background: #e0f2fe;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: bold;
      color: #0369a1;
      text-align: center;
      font-size: 14px;
    }
    .pdf-footer {
      margin-top: 40px;
      font-size: 10px;
      color: #94a3b8;
      text-align: center;
      border-top: 1px solid #e2e8f0;
      padding-top: 20px;
    }
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .loading-overlay.show {
      display: flex;
    }
    .loading-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      font-size: 16px;
      color: #1e293b;
    }
  </style>
</head>
<body>

<div class="loading-overlay" id="loading">
  <div class="loading-content">‚è≥ Gerando relat√≥rio PDF...</div>
</div>

<div class="app" id="main-app">
  <h1>üõ° Simulador de Reserva de Emerg√™ncia</h1>

  <div class="educational-section" style="margin-top: 20px; margin-bottom: 30px;">
    <h3>üìñ Como Usar Este Simulador</h3>
    <p>Esta ferramenta ajuda voc√™ a entender se sua reserva de emerg√™ncia √© suficiente. Voc√™ pode testar diferentes cen√°rios, incluindo situa√ß√µes de crise onde a infla√ß√£o sobe e sua renda cai.</p>
    <p><strong>Comece preenchendo os valores b√°sicos:</strong> seu saldo atual, gastos mensais e quanto voc√™ consegue poupar. Depois, explore os cen√°rios de crise para ver como sua reserva se comporta em momentos dif√≠ceis.</p>
  </div>

  <div class="grid">
    <div class="input-group"><label>Saldo inicial (R$)</label><input id="saldoInput" type="number" value="10000"></div>
    <div class="input-group"><label>Gasto mensal atual (R$)</label><input id="gastoInput" type="number" value="3000"></div>
    <div class="input-group"><label>Meses de reserva</label><input id="mesesInput" type="number" value="6"></div>
    <div class="input-group"><label>Aporte mensal (R$)</label><input id="aporteInput" type="number" value="500"></div>
    <div class="input-group">
      <label>Tipo de aporte</label>
      <select id="tipoAporteInput">
        <option value="nominal">Nominal (fixo)</option>
        <option value="real">Real (corrigido pela infla√ß√£o)</option>
      </select>
    </div>
    <div class="input-group"><label>Infla√ß√£o anual (%)</label><input id="ipcaInput" type="number" value="4"></div>
    <div class="input-group"><label>CDI / Selic anual (%)</label><input id="cdiInput" type="number" value="10"></div>
    <div class="input-group">
      <label>Choque inflacion√°rio (%)</label>
      <input id="choqueInput" type="number" value="12">
      <small>Infla√ß√£o excepcional (ex.: crises).</small>
    </div>
    <div class="input-group">
      <label>Dura√ß√£o do choque (meses)</label>
      <input id="choqueMesesInput" type="number" value="6">
      <small>Meses de infla√ß√£o elevada.</small>
    </div>
    <div class="input-group">
      <label>Perda de renda</label>
      <select id="perdaInput">
        <option value="0">Nenhuma</option>
        <option value="0.5">Parcial (50%)</option>
        <option value="1">Total</option>
      </select>
      <small>Redu√ß√£o de aporte na emerg√™ncia.</small>
    </div>
    <div class="input-group">
      <label>Mostrar +6 meses ap√≥s meta</label>
      <select id="extraMeses">
        <option value="0">N√£o</option>
        <option value="6">Sim</option>
      </select>
    </div>
  </div>

  <div class="educational-section" style="margin-top: 30px; margin-bottom: 20px; background: #fef3c7; border-left-color: #f59e0b;">
    <h3>‚ö° Entenda os Par√¢metros de Crise</h3>
    
    <p><strong>üî• Choque Inflacion√°rio (%):</strong> √â um aumento excepcional de pre√ßos acima da infla√ß√£o normal. Exemplo: se a infla√ß√£o normal √© 4% ao ano, um choque inflacion√°rio pode ser 12% ou mais. Isso acontece em crises econ√¥micas, desvaloriza√ß√£o da moeda, ou falta de produtos no mercado. Quando h√° choque, tudo fica mais caro de repente: alimentos, gasolina, energia.</p>
    
    <p><strong>üìÖ Dura√ß√£o do Choque (meses):</strong> Por quanto tempo essa infla√ß√£o alta vai durar? Em uma crise t√≠pica, pode durar 6 a 12 meses at√© as coisas normalizarem. Exemplo: em 2020, durante a pandemia, muitos pa√≠ses tiveram infla√ß√£o elevada por v√°rios meses. Este campo mostra quantos meses voc√™ quer simular com essa infla√ß√£o alta, e depois volta ao normal.</p>
    
    <p><strong>üìã Perda de Renda:</strong> Em crises, as pessoas frequentemente perdem renda. Pode ser desemprego total, redu√ß√£o de horas de trabalho, ou corte de b√¥nus. Este campo simula isso. Se voc√™ escolher "Parcial (50%)", significa que sua capacidade de poupar cai pela metade durante a crise. Se escolher "Total", significa que voc√™ n√£o consegue poupar nada durante a crise e precisa viver apenas da sua reserva.</p>
    
    <p><strong>Por que simular tudo isso junto?</strong> Porque crises reais funcionam assim: tudo fica mais caro E voc√™ ganha menos dinheiro ao mesmo tempo. √â o pior cen√°rio poss√≠vel. Se sua reserva aguenta isso, voc√™ est√° realmente seguro.</p>
  </div>

  <div class="button-group">
    <button class="btn-primary" onclick="calcular()">Simular Cen√°rio</button>
    <button class="btn-secondary" onclick="exportarPDF()">üìÑ Gerar Relat√≥rio PDF</button>
  </div>

  <div id="reservaValor" class="reserva" style="display:none"></div>
  <div id="alerta" class="alert" style="display:none"></div>
  <div id="meta" class="alert ok" style="display:none"></div>

  <div class="chart-container">
    <h3>üìä Evolu√ß√£o do Poder de Compra</h3>
    <p style="font-size: 12px; color: #64748b; margin: 0 0 15px 0;">
      <span style="color: var(--color-nominal); font-weight: bold;">- - -</span> Saldo Nominal (Ilus√£o) | 
      <span style="color: var(--color-real); font-weight: bold;">‚îÄ‚îÄ‚îÄ</span> Saldo Real (Realidade)
    </p>
    <canvas id="grafico"></canvas>
  </div>

  <div class="educational-section">
    <h3>üìö Conceitos Fundamentais</h3>
    <p><strong>Saldo Nominal vs. Real:</strong> O saldo nominal √© o n√∫mero que voc√™ v√™ na conta. O saldo real √© o que esse dinheiro realmente compra. Se o seu saldo cresce 10% mas a infla√ß√£o foi 12%, voc√™ ficou mais pobre apesar de ter "mais dinheiro".</p>
    <p><strong>Aporte Nominal vs. Real:</strong> Manter um aporte fixo (nominal) de R$ 500 por 5 anos √© um erro comum. Devido √† infla√ß√£o, esses R$ 500 comprar√£o muito menos no futuro, reduzindo seu esfor√ßo de poupan√ßa real sem voc√™ perceber.</p>
    <p><strong>Reserva de Emerg√™ncia:</strong> √â o dinheiro que voc√™ guarda para situa√ß√µes inesperadas (desemprego, doen√ßa, crise). O objetivo √© ter poder de compra real suficiente para viver alguns meses sem renda.</p>
  </div>

  <h3>üìã Tabela de Evolu√ß√£o</h3>
  <table id="tabela"></table>
</div>

<!-- Template para o PDF -->
<div id="pdf-content" class="pdf-hidden">
  <div class="pdf-header">
    <h1>Relat√≥rio Educativo: Reserva de Emerg√™ncia</h1>
    <p id="pdf-date"></p>
    <p id="pdf-params"></p>
  </div>
  
  <div class="pdf-summary" id="pdf-summary"></div>
  
  <div class="pdf-concept">
    <h3>üß† Saldo Nominal (O que voc√™ v√™) √ó Saldo Real (O que voc√™ tem)</h3>
    <p>Imagine que voc√™ tem R$ 10.000 na conta. Esse √© o <strong>saldo nominal</strong> ‚Äî o n√∫mero que aparece no seu banco. Mas ser√° que esses R$ 10.000 compram o mesmo que compravam h√° um ano?</p>
    <p>A resposta √© <strong>n√£o</strong>. Por causa da infla√ß√£o, o dinheiro perde valor com o tempo. O <strong>saldo real</strong> mostra quanto seu dinheiro realmente vale em termos de compra. Se a infla√ß√£o foi de 20% em um ano, aqueles R$ 10.000 agora compram apenas o equivalente a R$ 8.333.</p>
    <p><strong>Resumindo:</strong> A linha azul no gr√°fico (Saldo Real) √© o n√∫mero que realmente importa. Ela mostra se voc√™ est√° realmente seguro ou apenas tendo a ilus√£o de estar.</p>
  </div>

  <div class="pdf-concept">
    <h3>üí∏ Por que sua poupan√ßa mensal pode estar enfraquecendo</h3>
    <p>Voc√™ decide poupar R$ 500 por m√™s. √ìtimo! Mas aqui est√° o problema: se voc√™ sempre poupa exatamente R$ 500, sem aumentar esse valor, a infla√ß√£o est√° trabalhando contra voc√™.</p>
    <p>Exemplo real: Hoje, R$ 500 compram uma cesta de compras. Daqui a 5 anos, com infla√ß√£o de 4% ao ano, aqueles mesmos R$ 500 comprar√£o apenas o equivalente a R$ 410. Seu esfor√ßo de poupan√ßa ficou mais fraco sem voc√™ perceber!</p>
    <p><strong>A solu√ß√£o:</strong> Aumentar o aporte junto com a infla√ß√£o. Se a infla√ß√£o sobe 4% ao ano, voc√™ tamb√©m deveria aumentar sua poupan√ßa em 4% ao ano. Assim, seu esfor√ßo real permanece o mesmo.</p>
  </div>

  <div class="pdf-concept">
    <h3>‚ö° O Cen√°rio do Pior Caso: Crise + Desemprego</h3>
    <p>√Äs vezes, a vida nos coloca em situa√ß√µes extremas. Uma crise econ√¥mica pode trazer <strong>infla√ß√£o muito alta</strong> (tudo fica mais caro) <strong>E</strong> voc√™ pode perder sua renda (desemprego, redu√ß√£o de sal√°rio).</p>
    <p><strong>Exemplo:</strong> Imagine que a infla√ß√£o suba para <span id="pdf-choque-val"></span>% durante <span id="pdf-choque-meses"></span> meses, e voc√™ perca 50% da sua renda. Nessa situa√ß√£o, voc√™ n√£o consegue poupar mais, e o dinheiro que tem perde valor rapidamente. √â exatamente para isso que existe a reserva de emerg√™ncia.</p>
    <p><strong>O objetivo da simula√ß√£o:</strong> Mostrar se sua reserva √© suficiente para sobreviver a um per√≠odo assim. Se ela n√£o for, voc√™ sabe que precisa poupar mais.</p>
  </div>

  <div class="pdf-concept">
    <h3>üìä Entendendo o Gr√°fico</h3>
    <p><strong>Linha Laranja Tracejada (Saldo Nominal):</strong> √â o n√∫mero que voc√™ v√™ no banco. Sobe bastante, mas √© uma ilus√£o ‚Äî n√£o leva em conta a infla√ß√£o.</p>
    <p><strong>Linha Azul Cont√≠nua (Saldo Real):</strong> √â o que realmente importa. Mostra quanto poder de compra voc√™ realmente tem depois de descontar a infla√ß√£o. Se essa linha n√£o atingir a meta, voc√™ n√£o est√° realmente seguro.</p>
    <p><strong>Ponto Verde (Meta Atingida):</strong> Marca o m√™s em que voc√™ finalmente tem uma reserva real suficiente para enfrentar uma emerg√™ncia. Antes desse ponto, voc√™ ainda est√° vulner√°vel.</p>
  </div>

  <div class="pdf-concept" style="background: #fff; border: 1px solid #e2e8f0;">
    <h3>‚úÖ O Que Voc√™ Aprendeu com Esta Simula√ß√£o</h3>
    <p>Esta ferramenta foi criada para voc√™ entender que <strong>guardar dinheiro n√£o √© apenas sobre ter um n√∫mero grande na conta</strong>. √â sobre ter poder de compra real.</p>
    <p>Muitas pessoas acham que est√£o seguras porque veem seus saldos crescerem. Mas se a infla√ß√£o est√° comendo esse crescimento, elas podem estar em perigo sem perceber. A simula√ß√£o mostra exatamente isso.</p>
    <p><strong>Resultado da sua simula√ß√£o:</strong> <span id="pdf-conclusao"></span></p>
  </div>

  <div class="pdf-footer">
    Simulador de Reserva de Emerg√™ncia - Documento Educativo para Planejamento Financeiro<br>
    Gerado em: <span id="pdf-footer-date"></span>
  </div>
</div>

<script>
'use strict';

let chart;
let ultimosDados = {};

const moeda = v => isFinite(v)
  ? v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
  : '‚Äî';

function calcular() {
  try {
    const saldoInicial = Number(document.getElementById('saldoInput')?.value) || 0;
    const gastoBase = Number(document.getElementById('gastoInput')?.value) || 0;
    const mesesReserva = Number(document.getElementById('mesesInput')?.value) || 0;
    const aporteBase = Number(document.getElementById('aporteInput')?.value) || 0;
    const tipoAporte = document.getElementById('tipoAporteInput')?.value || 'nominal';
    const ipcaAnual = (Number(document.getElementById('ipcaInput')?.value) || 0) / 100;
    const cdiAnual = (Number(document.getElementById('cdiInput')?.value) || 0) / 100;
    const choqueAnual = (Number(document.getElementById('choqueInput')?.value) || 0) / 100;
    const choqueMeses = Number(document.getElementById('choqueMesesInput')?.value) || 0;
    const perda = Number(document.getElementById('perdaInput')?.value) || 0;
    const extraMeses = Number(document.getElementById('extraMeses')?.value) || 0;

    const ipca = ipcaAnual / 12;
    const cdi = cdiAnual / 12;
    const choque = choqueAnual / 12;

    let saldoAtual = saldoInicial;
    let reservaNecessaria = 0;
    let labels = [], saldoNominal = [], saldoReal = [];
    let metaMes = null;
    let inflacaoAcumulada = 1;

    let tabelaHTML = '<tr><th>M√™s</th><th>Gasto corrigido</th><th>Saldo nominal</th><th>Saldo real</th></tr>';

    let i = 1;
    const LIMITE = 180;

    while (i <= LIMITE) {
      const inflacaoMes = i <= choqueMeses ? choque : ipca;
      inflacaoAcumulada *= (1 + inflacaoMes);

      const gastoCorrigido = gastoBase * inflacaoAcumulada;
      if (i <= mesesReserva) reservaNecessaria += gastoCorrigido;

      let aporteMes = aporteBase;
      if (tipoAporte === 'real') aporteMes *= inflacaoAcumulada;
      if (perda > 0 && i <= mesesReserva) aporteMes *= (1 - perda);

      saldoAtual = saldoAtual * (1 + cdi) + aporteMes;
      const saldoRealMes = saldoAtual / inflacaoAcumulada;

      labels.push(i);
      saldoNominal.push(saldoAtual);
      saldoReal.push(saldoRealMes);

      const metaClass = (metaMes === null && saldoRealMes >= reservaNecessaria) ? 'meta-row' : '';
      tabelaHTML += `<tr class="${metaClass}"><td>${i}</td><td>${moeda(gastoCorrigido)}</td><td>${moeda(saldoAtual)}</td><td>${moeda(saldoRealMes)}</td></tr>`;

      if (metaMes === null && saldoRealMes >= reservaNecessaria) {
        metaMes = i;
        if (extraMeses === 0) break;
      }
      if (metaMes !== null && i >= metaMes + extraMeses) break;
      i++;
    }

    ultimosDados = {
      metaMes,
      reservaNecessaria,
      tipoAporte,
      choque: document.getElementById('choqueInput').value,
      choqueMeses: document.getElementById('choqueMesesInput').value,
      saldoNominal,
      saldoReal,
      labels
    };

    document.getElementById('tabela').innerHTML = tabelaHTML;
    const rv = document.getElementById('reservaValor');
    rv.style.display = 'block';
    rv.innerText = `üí∞ Valor da reserva necess√°ria: ${moeda(reservaNecessaria)}`;

    const ctx = document.getElementById('grafico');
    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: 'Saldo nominal (ilus√£o)',
            data: saldoNominal,
            borderColor: '#fb923c',
            backgroundColor: 'rgba(251, 146, 60, 0.05)',
            borderDash: [6, 6],
            borderWidth: 2,
            pointRadius: 0,
            pointHoverRadius: 5,
            tension: 0.3
          },
          {
            label: 'Saldo real (realidade)',
            data: saldoReal,
            borderColor: '#2563eb',
            backgroundColor: 'rgba(37, 99, 235, 0.05)',
            borderWidth: 3,
            pointRadius: 0,
            pointHoverRadius: 5,
            tension: 0.3
          },
          metaMes ? {
            label: 'Meta Atingida',
            data: labels.map(m => m === metaMes ? saldoReal[labels.indexOf(m)] : null),
            borderColor: '#16a34a',
            backgroundColor: '#16a34a',
            pointRadius: 8,
            pointHoverRadius: 10,
            showLine: false
          } : null
        ].filter(Boolean)
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        interaction: { mode: 'index', intersect: false },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: { display: true, text: 'Valor (R$)' },
            ticks: { callback: value => moeda(value) }
          }
        },
        plugins: {
          legend: { position: 'top', labels: { usePointStyle: true } },
          tooltip: { 
            callbacks: {
              label: function(context) {
                return context.dataset.label + ': ' + moeda(context.parsed.y);
              }
            }
          }
        }
      }
    });

    const alerta = document.getElementById('alerta');
    alerta.style.display = tipoAporte === 'nominal' ? 'block' : 'none';
    alerta.innerText = '‚ö†Ô∏è Aten√ß√£o: Voc√™ escolheu Aporte Nominal. Com o tempo, seu esfor√ßo real de poupan√ßa diminuir√° devido √† infla√ß√£o.';

    const meta = document.getElementById('meta');
    meta.style.display = 'block';
    meta.innerText = metaMes ? `üéØ Meta atingida! Voc√™ completa sua reserva no m√™s ${metaMes}.` : '‚ùå Com os par√¢metros atuais, a reserva n√£o √© atingida no prazo simulado.';

  } catch (e) {
    console.error('Erro na simula√ß√£o', e);
    alert('Erro na simula√ß√£o. Verifique os valores informados.');
  }
}

function exportarPDF() {
  if (Object.keys(ultimosDados).length === 0) {
    alert('Por favor, execute uma simula√ß√£o antes de exportar o PDF.');
    return;
  }

  document.getElementById('loading').classList.add('show');

  setTimeout(() => {
    try {
      const agora = new Date();
      document.getElementById('pdf-date').innerText = `Gerado em: ${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
      document.getElementById('pdf-params').innerText = `Simula√ß√£o com Aporte ${ultimosDados.tipoAporte === 'nominal' ? 'Nominal' : 'Real'}`;
      document.getElementById('pdf-summary').innerText = document.getElementById('reservaValor').innerText;
      document.getElementById('pdf-choque-val').innerText = ultimosDados.choque;
      document.getElementById('pdf-choque-meses').innerText = ultimosDados.choqueMeses;
      document.getElementById('pdf-conclusao').innerText = document.getElementById('meta').innerText;
      document.getElementById('pdf-footer-date').innerText = agora.toLocaleDateString('pt-BR');

      const element = document.getElementById('pdf-content');
      const opt = {
        margin: 10,
        filename: 'Relatorio_Reserva_Emergencia_Educativo.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, logging: false },
        jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
      };

      html2pdf().set(opt).from(element).save();
      
      document.getElementById('loading').classList.remove('show');
      alert('‚úÖ Relat√≥rio PDF gerado com sucesso!');
    } catch (e) {
      document.getElementById('loading').classList.remove('show');
      console.error('Erro ao gerar PDF:', e);
      alert('Erro ao gerar o PDF. Tente novamente.');
    }
  }, 100);
}

window.addEventListener('load', () => {
  calcular();
});
</script>

</body>
</html>
